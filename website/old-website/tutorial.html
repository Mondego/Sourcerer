<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
<title>Sourcerer Project: Tutorial</title>
<link rel="stylesheet" href="css/sourcerer.css" type="text/css" />
</head>

<body>
<div id="container">
<div id="header">
<div id="a1"></div>
<div id="a2"></div>
<div id="a3"></div>
<div id="a4"></div>
<div id="a5"></div>
The Sourcerer Project
</div>
<div id="content">
<div id="main">
<h1>Tutorial</h1>
<p>
  This tutorial is designed to show the reader how to download, install,
  and use the Sourcerer infrastructure to build SourcererDB.
</p>
<p>
  This tutorial can be completed using either the command-line
  or Eclipse. In either case, you must have a working version
  of the <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">
  Java Development Kit</a>, <a href="http://git-scm.com/">Git</a>, and
  a <a href="http://www.mysql.com/">MySQL</a> server. The 
  command-line tutorial is recommended for
  those looking to use Sourcerer for large-scale analysis,
  as the command-line interaction is better suited for server
  machines. 
</p>
<ul>
  <li>
    If you intend to complete the tutorial using the command-line, you
    must have both <a href="http://ant.apache.org/">Ant</a> and
    <a href="http://www.eclipse.org">Eclipse</a> installed. Eclipse
    will not be run graphically, but is necessary for the extractor
    to function. 
  </li>
  <li>
    If you intend to complete the tutorial using Eclipse, you only
    need to have <a href="http://www.eclipse.org">Eclipse</a> installed.
  </li>
</ul>
<p>
  Steps specific to the command-line are prefaced with <span style="color:#534874;font-weight:bold;">Command-Line)</span>, while
  steps specific to the Eclipse are prefaced with <span style="color:#534874;font-weight:bold;">Eclipse)</span>.
</p>

<h2>Step 1: <span class="colora">Download Sourcerer</span></h2>
<div class="sub">
  <p>
    Run
  </p>
  <div class="code-block">
    [install]$ git clone https://github.com/sourcerer/Sourcerer.git
  </div>
  <p>
    where <span class="fixed">[install]</span> is the directory into which
    you wish to download Sourcerer.
  </p>
  
  <h3>Eclipse) Load Sourcerer in Eclipse</h3>
  <div class="sub">
    <p>
      Do the following once you have opened a fresh Eclipse workspace.
    </p>
    <ol>
      <li>Go to <span class="fixed">File-&gt;Import</span></li>
      <li>Select <span class="fixed">General-&gt;Existing Projects into Workspace</span> and hit <span class="fixed">Next</span>.</li>
      <li>Click <span class="fixed">Browse</span> next to <span class="fixed">Select Root Directory</span>.</li>
      <li>Navigate to the <span class="fixed">[install]/Sourcerer</span> directory and click <span class="fixed">OK</span>.</li>
      <li>Make sure the following projects are selected
        <ul>
          <li><span class="fixed">bin</span></li>
          <li><span class="fixed">database</span></li>
          <li><span class="fixed">database-utilities</span></li>
          <li><span class="fixed">extractor</span></li>
          <li><span class="fixed">lib</span></li>
          <li><span class="fixed">link-crawler</span></li>
          <li><span class="fixed">model</span></li>
          <li><span class="fixed">repository-manager</span></li>
          <li><span class="fixed">java-repository-manager</span></li>
          <li><span class="fixed">utilities</span></li>
        </ul>
      </li>
      <li>Click finish, and wait for the projects to build.</li>
      <li>
        Once built, there will be missing dependencies for the <span class="fixed">extractor</span> project.
        To correct this, go to the <span class="fixed">bin</span> project, and run <span class="fixed">launch/lib/extractor-lib.launch</span>.
        Then refresh the <span class="fixed">bin</span> project, and the error should disappear.
      </li> 
    </ol>
  </div>
</div>

<h2>Step 2: <span class="colora">Set up a Repository</span></h2>
<div class="sub">
  <p>
    For the purposes of the tutorial, there are four ways setting up the repository. They
    all result in a repository located in a directory referred to as <span class="code">[root]</span>
    for the remainder of this tutorial. So pick either 2.A, 2.B, 2.C or 2.D.
  </p>

  <h3>2.A) Create the test-repository</h3>
  <div class="sub">
    <p>
      Run (Eclipse launcher <span class="fixed">launch/test-repo/Create test repo.launch</span>)
    </p>
    <div class="code-block">
      [install]$ cd Sourcerer/bin<br>
      [install]/Sourcerer/bin$ ant create-test-repo
    </div>
    <p>
      This creates a test repository. To view it's contents, run
    </p>
    <div class="code-block">
      [install]/Sourcerer/bin$ cd ../infrastructure/tools/java/extractor/test-repo<br>
      [install]/Sourcerer/infrastructure/tools/java/extractor/test-repo$ ls
    </div>
    <p>
      This test repository contains three projects, <span class="fixed">0/0</span>, a project for testing the 
      feature extractor, <span class="fixed">0/1</span>, a subset of the Sourcerer infrastructure, and <span class="fixed">0/2</span>,
      an additional feature extractor test project.
    </p>
  </div>

  <h3>2.B) Download a sample repository</h3>
  <div class="sub">
    <p>
      A sample repository containing a small random selection of projects from 
      the full repository can be found online
      <a href="http://sourcerer.ics.uci.edu/files/sample-repo.tgz">here</a>.
      Simply download this file and extract it to the desired directory.
    </p>
  </div>
  
  <h3>2.C) Download the full repository</h3>
  <div class="sub">
    <p>
      The full repository can be found online 
      <a href="http://www.ics.uci.edu/~lopes/datasets/SDS_source-repo-18k.html">here</a>.
      Simply download this file (very very big) and extract it to the desired directory.
    </p>
  </div>
  
  <h3>2.D) Create your own repository</h3>
  <div class="sub">
    <p>
      To create a repository with custom projects, simply follow the repository 
      structure <a href="repository.html">here</a>.
    </p>
    
    <h4>2.D.1) Create <span class="fixed">[ROOT]</span> directory</h4>
    <div class="sub">
      <div class="code-block">
        [?]$ mkdir [root]<br>
        [?]$ cd [root]
      </div>
    </div>
    
    <h4>2.D.2) Create project directories</h4>
    <div class="sub">
      <p>
        For every project you wish to include in the repository, create a subdirectory of
        <span class="fixed">[root]</span> of the form <span class="fixed">[root]/[number]/[number]</span>.
        For example, if you wanted to create a repository with 3 projects, you would do the following.
      </p>
      <div class="code-block">
        [root]$ mkdir 0<br>
        [root]$ mkdir 0/0<br>
        [root]$ mkdir 0/1<br>
        [root]$ mkdir 0/2<br>
        [root]$ ls<br>
        0<br>
        [root]/0$ cd 0<br>
        [root]$ ls<br>
        0 1 2
      </div>
      <p>
        This creates space for 3 projects. It doesn't matter what numbers are picked 
        for the directories, as long as they are numbers.
      </p>
    </div>
    
    <h4>2.D.3) Add project content</h4>
    <div class="sub">
      <p>
        To add the actual content for each project, do the following.
      </p>
      <div class="code-block">
        [root]/0$ cd 0<br>
        [root]/0/0$ mkdir content<br>
        [root]/0/0$ cp -R [project-content]/* content
      </div>
      <p>
        This copies the contents of the project from some <span class="code">[project-content]</span>
        directory into the content directory of the repository. This content can be any combination of Java 
        source code and jar files.
      </p>
    </div>
  
    <h4>2.D.4) Create <span class="fixed">project.properties</span> files</h4>
    <div class="sub">
      <div class="code-block">
        [root]/0/0$ echo name=[project-name] &gt; project.properties
      </div>
      <p>
        There are a number of other supported properties, but the only required one is name.
      </p>
    </div>
  </div>
</div>

<h2>Step 3: <span class="colora">Compile the repository tools</span></h2>
<div class="sub">
  <h3>Command-Line) Compile</h3>
  <div class="sub">
    <p>
      Run (Eclipse launcher <span class="fixed">launch/lib/repo-tools.launch</span>)
    </p>
    <div class="code-block">
      [install]/Sourcerer/bin$ ant repo-tools 
    </div>
    <p>
      This will create <span class="fixed">repo-tools.jar</span> in the <span class="fixed">dist</span> subdirectory. We will
      refer to this subdirectory as <span class="fixed">[install-dist]</span>.
    </p>
  </div>
  <h3>3.A) Test</h3>
  <div class="sub">
    <p>
      Running (Eclipse launcher <span class="fixed">launch/tutorial/Step 3 - Repo Tools.launch</span>)
    </p>
    <div class="code-block">
      [install]/Sourcerer/bin$ cd dist<br>
      [install-dist]$ java -jar repo-tools.jar
    </div>
    <p>
      will print a complete list of the commands provided by <span class="fixed">repo-tools.jar</span>.
    </p>
  </div>
</div>

<h2>Step 4: <span class="colora">Finish setting up the repository</span></h2>
<div class="sub">
  <h3>Eclipse) Set up properties file</h3>
  <div class="sub">
    <ol>
      <li>
        Open the file <span class="fixed">tutorial.properties</span>, found in
        <span class="fixed">launch/tutorial</span>.
      </li>
      <li>
        On the first line, for the property <span class="fixed">input-repo</span>,
        replace <span class="fixed">[root]</span> with the path to the repository
        you created in Step 2. As this is a Java properties file, make sure to 
        escape any used of <span class="fixed">\</span> as <span class="fixed">\\</span>. 
      </li>
      <li>
        On the second line, for the property <span class="fixed">output-repo</span>,
        replace <span class="fixed">[path]</span> with the path to where you would
        like the extracted version of the repository to be stored. As this is a Java 
        properties file, make sure to any used of <span class="fixed">\</span> as 
        <span class="fixed">\\</span>.
    </ol>
  </div>
  <h3>4.1) Aggregate jar files</h3>
  <div class="sub">
    <p>
      <span class="colora bold">Note</span>: If you used step 2.A (create-test-repo ant task), this task have already been run and you may skip this step.
    </p>
    
    <p>
      Run (Eclipse launcher <span class="fixed">launch/tutorial/Step 4 - Aggregate Jar Files.launch</span>)
    </p>
    <div class="code-block">
      [install-dist]$ java -jar repo-tools.jar --aggregate-jar-files --input-repo [root]
    </div>
    <p>
      If you are running it from the command line, you should replace <span class="fixed">[root]</span> with the
      path to the repository you created in Step 2.
    </p>
    <p>
      This collects all of the jar files in the repository into the jars directory. To see the result, do the following.
    </p>
    <div class="code-block">
      [?]$ cd [root]<br>
      [root]$ ls jars<br>
      jars<br>
      [root]$ cd jars<br>
      [root]/jars$ ls<br>
      project
    </div>
    <p>
      The project subdirectory contains all of the jar files aggregated from the repository. They are stored in a two-layered structure
      of directories, similar to the main repository itself.
    </p>
  </div>
  <h3>4.2) Other commands</h3>
  <div class="sub">
    <p>
      Some other commands that might be interesting to run are: (the Eclipse launchers are all found in <span class="fixed">launch/tutorial</span>)
    </p>
    <div class="code-block">
      [?]$ cd [install]/Sourcerer/bin/dist<br>
      [install-dist]$ java -jar repo-tools.jar --print-repo-disk-usage --input-repo [root]<br>
      [install-dist]$ java -jar repo-tools.jar --print-project-names --input-repo [root]<br>
      [install-dist]$ java -jar repo-tools.jar --print-jar-stats --input-repo [root]<br>
      [install-dist]$ java -jar repo-tools.jar --print-project-sizes --input-repo [root]<br>
    </div>
    <p>
      If you wish for the output logs to be saved to a file, the <span class="fixed">--output [path]</span>
      parameter may be added. When this parameter is specified, logs are saved to 
      <span class="fixed">[path]/[command name]/[date]/[time]</span> and are no longer printed to the command line. 
      To have them printed to the command line again, add the <span class="fixed">--report-to-console</span> flag.
    </p>
  </div>
</div>

<h2>Step 5: <span class="colora">Set up the Extractor</span></h2>
<div class="sub">
  <h3>Command-Line) Build Extractor plugin</h3>
  <div class="sub">
    <p>
      Unfortunately, as the extractor is an Eclipse plugin, this step cannot be done from the command line.
      You can download the plugin <a href="">here</a>. Place it in the <span class="fixed">[install]/Sourcerer/bin/plugins</span>
      directory (you will have to create this directory).
    </p>
    <p>
      If you decided to load the projects into Eclipse, you can instead run <span class="fixed">launch/extractor/Build Extractor</span>.
      This Eclipse-specific ant task will create the plugin and place it in the directory mentioned above.
    </p>
    <p>
      Next, run <span class="fixed">launch/extractor/Repackage Extractor.launch</span>
    </p>
    <div class="code-block">
      [?]$ cd [install]/Sourcerer/bin<br>
      [install]/Sourcerer/bin$ ant repackage-extractor<br>
    </div>
    <p>
      This ant task will repackage the plugin to contain the necessary dependencies, and will place it in the <span class="fixed">dist</span> directory.
    </p>
  </div>
  <h3>Command-Line) Copy plugin into Eclipse</h3>
  <div class="sub">
    <p>
      As the Extractor is a headless Eclipse plugin, it must be installed into a working Eclipse instance. This installation can be done as follows:
    <p>
    <ol>
      <li>Download a recent version of Eclipse and extract it to some directory <span class="fixed">[eclipse]</span>.</li>
      <li>Place the Extractor_1.0.0.jar file generated by the ant task in the [eclipse]/plugins directory.</li>
    </ol>
  </div>
  
  <h3>5.A) Test Extractor</h3>
  <div class="sub">
    <p>
      To test that it's working, run (Eclipse launcher <span class="fixed">launch/tutorial/Step 5 - Test Extractor.launch</span>) 
    </p>
    <div class="code-block">
      [?]$ java -jar [eclipse]/plugins/org.eclipse.[version-name].launcher_[version-number].jar -consolelog -application Extractor.Extractor
    </div>
    <p>
      The result should be a list of the 3 commands supported by the Extractor.
    </p>
  </div>
</div>

<h2>Step 6: <span class="colora">Run the Extractor</span></h2>
<div class="sub">
  <h3>6.A) Extract Libraries</h3>
  <div class="sub">
    <p>
      Before the Java libraries can be extracted, they must be added to the repository. To do this,
      run (Eclipse launcher <span class="fixed">launch/tutorial/Step 6 - Add Java Libraries to Repo.launch</span>)
    </p>
    <div class="code-block">
      [?]$ java -jar [...] -application Extractor.Extractor --add-libraries-to-repo --output-repo [path]
    </div>
    <p>
      Now the repository is ready to extract Java library code. To do so, run (Eclipse launcher <span class="fixed">launch/tutorial/Step 6 - Extract Libraries.launch</span>)
    </p>
    <div class="code-block">
      [?]$ java -jar [...] -application Extractor.Extractor --extract-libraries --output-repo [path]
    </div>
    <p>
      Unfortunately, Eclipse buffers all output printed to <span class="fixed">System.out</span>/<span class="fixed">System.err</span> by headless plugins until
      the termination of the plugin. Therefore, to receive real-time feedback regarding the status of the Extractor, you must add the <span class="fixed">output</span>
      property. For the command-line, this entails adding <span class="fixed">--output [path]</span> to the end of the command. For Eclipse, this means uncommenting a line
      in <span class="fixed">tutorial.properties</span> that says <span class="fixed">output=[path]</span>. In either case, <span class="fixed">[path]</span> should
      be the path to where the output logs get written. 
    </p>
    <p>
      You can track the progress of the extractor by running 
    </p>
    <div class="code-block">
      [?]$ tail -f [output-path]/extract-libraries/[date]/[time]/error.log
    </div>
    <p>
      When using the command-line, it is recommended to run this in the background (using &amp;), 
      as it can take a while to complete.
    </p>
    <p>
      The results of the extraction can be seen in <span class="fixed">[output-repo]/libs/</span>. The extracted 
      data for each Java library jar file is contained within the directory with that 
      jar file's name. <span class="fixed">rt.jar</span> contains the vast majority of the Java library. Looking 
      into any directory, you can see the various flat files that are used to build the database.
    </p>
  </div>
  <h3>6.B) Extract Jars</h3>
  <div class="sub">
    <p>
      Next, extract the jar files using (Eclipse launcher <span class="fixed">launch/tutorial/Step 6 - Extract Jars.launch</span>)
    </p>
    <div class="code-block">
      [?]$ java -jar [...] -application Extractor.Extractor --extract-jars --input-repo [path] --output-repo [path]
    </div>
    <p>
      Notice that an input-repo is needed this time, as the jar files are not being picked off the Java classpath.
    </p>
    <p>
      The results of this extraction can be found in <span class="fixed">[output-repo]/jars/</span>.
    </p>
  </div>
  <h3>6.C) Extract Projects</h3>
  <div class="sub">
    <p>
      Lastly, extract the source files using (Eclipse launcher <span class="fixed">launch/tutorial/Step 6 - Extract Projects.launch</span>) 
    </p>
    <div class="code-block">
      [?]$ java -jar [...] -application Extractor.Extractor --extract-projects --input-repo [path] --output-repo [path]
    </div>
    <p>
      The results of this extraction can be found in <span class="fixed">[output-repo]</span>.
    </p>
  </div>
</div>
  
<h2>Step 7: <span class="colora">Set up the database</span></h2>
<div class="sub">
  <h3>7.A) Set up database</h3>
  <div class="sub">
    <p>
      Connect to your MySQL server, running at some url, <span class="fixed">url</span>.
      Create a database named, <span class="fixed">[db]</span> for SourcererDB. 
    </p>
    <div class="code-block">
      create database [db];
    </div>
    <p>
      Give the user permission to the database.
    </p>
    <div class="code-block">
      grant all on [db].* to [user];
    </div>
  </div>
  <h3>Eclipse) Set up properties file</h3>
  <div class="sub">
    <ol>
      <li>
        Open the file <span class="fixed">tutorial-db.properties</span>, found in
        <span class="fixed">launch/tutorial</span>.
      </li>
      <li>
        On the first line, for the property <span class="fixed">input-repo</span>,
        replace <span class="fixed">[path]</span> with the path to the <span style="font-weight:bold; font-style: italic;">output</span> repository
        used in the extraction. As this is a Java properties file, make sure to 
        escape any used of <span class="fixed">\</span> as <span class="fixed">\\</span>. 
      </li>
      <li>
        On the second line, for the property <span class="fixed">database-url</span>,
        replace <span class="fixed">[url]</span> with the url of your MySQL instance,
        and replace <span class="fixed">[db]</span> with the name of the database.
      </li>
      <li>
        On the third line, for the property <span class="fixed">database-user</span>,
        replace <span class="fixed">[user]</span> with the name of the database user.
      </li>
      <li>
        On the fourth line, for the property <span class="fixed">database-password</span>,
        replace <span class="fixed">[password]</span> with the name of the database password.
      </li>
    </ol>
  </div>
  <h3>7.B) Extraction summary</h3>
  <div class="sub">
    <p>
      To view some summary statistics of the extraction, please run (Eclipse launcher <span class="fixed">launch/tutorial/Step 7 - Extraction Stats.launch</span>)
    </p>
    <div class="code-block">
      [?]$ cd [install-dist]<br>
      [install-dist]$ java -jar repo-tools.jar --extraction-stats --input-repo [path]
    </div>
    <p>
      This will create an extraction-stats.txt file which contains some 
      details on what was extracted from the repository.
    </p>
  </div>
</div>

<h2>Step 8: <span class="colora">Set up the database tools</span></h2>
<div class="sub">
  <h3>Command-Line) Build <span class="fixed">sourcerer-db.jar</span></h3>
  <div class="sub">
    <div class="code-block">
      [?]$ cd [install]/Sourcerer/bin<br>
      [install]/Sourcerer/bin$ ant sourcerer-db
    </div>
    <p>
      This will create a <span class="fixxed">sourcerer-db.jar</span> in <span class="fixed">[install]/Sourcerer/bin/dist</span>.
    </p>
  </div>
</div>

<h2>Step 9: <span class="colora">Set up the database tools</span></h2>
<div class="sub">
  <h3>Initialize DB</h3>
  <div class="sub">
    <p>
      Run (Eclipse launcher <span class="fixed">launch/tutorial/Step 9 - Initialize DB.launch</span>)
    </p>
    <div class="code-block">
      [?]$ cd [install]/Sourcerer/bin/dist
      [install-dist]$ java -jar sourcerer-db.jar --database-url jdbc:mysql://[url]/[db] --database-user [user] --database-password [password] --initialize-db
    </div>
  </div>
  
  <h3>Import Libraries</h3>
  <div class="sub">
    <p>
      Run (Eclipse launcher <span class="fixed">launch/tutorial/Step 9 - Import Libraries.launch</span>)
    </p>
    <div class="code-block">
      [?]$ cd [install]/Sourcerer/bin/dist
      [install-dist]$ java -jar sourcerer-db.jar --database-url jdbc:mysql://[url]/[db] --database-user [user] --database-password [password] --add-libraries --input-repo [path]
    </div>
    <p>
      Where <span class="fixed">[path]</span> for <span class="fixed">input-repo</span> is the path to the 
      <span style="font-weight:bold; font-style: italic;">output</span> repository used in the extraction.
    </p> 
  </div>
  
  <h3>Import Jars</h3>
  <div class="sub">
    <p>
      Run (Eclipse launcher <span class="fixed">launch/tutorial/Step 9 - Import Jars.launch</span>)
    </p>
    <div class="code-block">
      [?]$ cd [install]/Sourcerer/bin/dist
      [install-dist]$ java -jar sourcerer-db.jar --database-url jdbc:mysql://[url]/[db] --database-user [user] --database-password [password] --add-jars --input-repo [path]
    </div>
  </div>
  
  <h3>Import Projects</h3>
  <div class="sub">
    <p>
      Run (Eclipse launcher <span class="fixed">launch/tutorial/Step 9 - Import Projects.launch</span>)
    </p>
    <div class="code-block">
      [?]$ cd [install]/Sourcerer/bin/dist
      [install-dist]$ java -jar sourcerer-db.jar --database-url jdbc:mysql://[url]/[db] --database-user [user] --database-password [password] --add-projects --input-repo [path]
    </div>
  </div>  
</div>

<h2>Step 10: <span class="colora">Explore the database</span></h2>
<div class="sub">
  <p>
    Connect to the database and look around at what you have.
  </p>
</div>

</div>
</div>
<div id="navbar">
  <div><a href="index.html">Overview</a></div>
  <div><a href="infrastructure.html">Core Infrastructure</a></div>
  <div><a href="repository.html">Repository</a></div>
  <div><a href="sourcerer-db.html">SourcererDB</a></div>
  <div><a href="services.html">Services</a></div>
  <div><a href="code-search-engine.html">Code Search Engine</a></div>
  <!--<div><a href="code-genie.html">CodeGenie</a></div> -->
  <div><a class="sel" href="tutorial.html">Tutorial</a></div>
  <div><a href="people.html">People</a></div>
  <div><a href="publications.html">Publications</a></div>
</div>
</div>
</body>
</html>
